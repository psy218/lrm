---
title: "analysis_report"
author: "Sue Song"
date: 'Sys.Date()'
output: html_document
---
# Setting the environment
## Set global chunk options
```{r global_options, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE, 
                      message = FALSE,
                      cache=TRUE,
                      highlight = TRUE)
```
## Set package options
```{r package_options, include=FALSE, message=FALSE}
knitr::opts_knit$set(progress = FALSE, verbose = FALSE)
options(digits = 3, scipen = 10)
```
## Load packages
```{r library, include=FALSE, message=FALSE}
library("tidyverse"); library("broom"); library("ggplot2"); library("here")
```

For reproducibility, two options for recording packages used:  
a) using `checkpoint` package
```{r checkpoint, message=FALSE}
checkpoint::checkpoint(Sys.Date()) # create a snapshot folder for all the install pakges
getOption("repos") # check that the CRAN mirror set to MRAN snapshot
```

b) Record session informations using `sessionInfo()`  
```{r}
sessionInfo()
```

## 1. Importing a dataset from the master script
```{r data, message=FALSE, include=FALSE}
source(here("data_analysis", "data_analysis_prep.R"))
```

## 1.5 Prep your data
### Eligibile participants
```{r exclusion}
df <- df %>%
  mutate(exclusion = case_when(
    attn_check == "pass" &
      var_low == "acceptable" ~ "eligible",
    TRUE ~ "ineligible"))
```

Check the number of eligible participants
```{r}
table(df$exclusion)
```

### Center your variables
```{r}
df <- df %>%
  filter(exclusion == "eligible") %>%
  mutate(prom.c = promotion - mean(promotion, na.rm = T),
         prev.c = prevention - mean(prevention, na.rm = T))
```


## 2. Run analyses like a boss
### Demographics
```{r demographics, dependson="exclusion"}
(demographics <- df %>%
   group_by(exclusion) %>%
  summarize(n = n(),
            age = round(mean(age, na.rm = T),2),
            female = length(which(gender == "female")),
            male = length(which(gender == "male"))))
```

In our sample, `r demographics$n[demographics$exclusion=="eligible"]` participants met our eligibile criteria to participate  

### Correlations
Bi-variate correlation using:
a) `psych` package
```{r}
psych::corr.test(df[ ,c("promotion", "prevention")], 
                 df[ ,c("profile_num", "profile_interest_num")],
                 use = "pairwise",
                 method = "pearson",
                 adjust = "none")
```


b) `Hmisc` package:
```{r message=FALSE}
df %>%
  select(promotion, prevention, profile_num, profile_interest_num) %>%
  as.matrix() %>% 
  Hmisc::rcorr()
```

c) `corrplot` package:
```{r}
df %>%
  select(promotion, prevention, profile_num) %>%
  cor(use="complete.obs") %>%
  corrplot::corrplot(method="color", type = "upper", addCoef.col = "black", tl.col = "black", tl.srt = 45,
                     sig.level = 0.01, insig = "blank", diag = F)
```

### Regression analyses
```{r}
glm(profile_num ~ promotion + prevention, 
            family = "poisson",
            data = subset(df, exclusion =="eligible")) %>%
  summary.glm
  # %>% broom::tidy()
```

### plot
```{r}
df %>%
  ggplot() +
  geom_smooth(aes(x = prom.c, y = fit_success),  colour = "blue", method = lm, se = T) +
  geom_smooth(aes(x = prev.c, y = fit_success),  colour = "gold", method = lm, se = T) +
  labs( x = "Regulatory focus", y = "Overall Perceived Success") +
  facet_wrap(~condition, labeller = as_labeller(condition_label)) + 
  labs(x = "Regulatory Focus", y = "Strategy Ease")
```


# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup


