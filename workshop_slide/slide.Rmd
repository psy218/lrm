---
title: "rmarkdown"
author: "Sue Song"
date: '2018-11-04'
output: 
  html_document: 
    toc: yes
    toc_float: true
    keep_md: true
    self_contained: no
  github_document:
    toc: true
    toc_depth: 2
    html_preview: false
  word_document: default
editor_options:
  chunk_output_type: inline
bibliography: zotero_ref.bib
---
# R environment 
```{r global_options, message=FALSE, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, 
                      warning=FALSE, 
                      message=FALSE, 
                      cache=TRUE,
                      highlight = TRUE,
                      fig.width = 8, 
                      fig.height = 5,
                      fig.show="hold")
```

```{r package_options, message=FALSE, include=FALSE}
knitr::opts_knit$set(progress = FALSE, verbose = FALSE)
options(digits = 3, scipen = 10)
```

```{r library, message=FALSE, include=FALSE}
library("tidyverse"); library("here"); library("knitr")
```

# Structure 
## 1. Header  
### Metadata in the Header (YAML)  
![](/slide/slide_files/structure.png)

translate the argument into YAML using `yaml::as.yaml`.  
```{r}
cat(yaml::as.yaml(list(
  title = "example document",
  author = "su so"
)))
```

Essential components:
1. output format
  + `html_document`
  + `word_document`
  + `pdf_document`
  
2. `bibliography`
use [@R-base] 

## 2. Code chunks  
### Step 1. Insert code chunks
Keyboard shortcuts:
- Ctrl + Alt + I (Windows)
- Cmd + Option + I (Mac)

### Step 2. Define *chunk options*


#### Options for the output documents
A full list of options available [here](https://yihui.name/knitr/options/).

*`eval`: execute a code chunk?
*`echo`: include the source code in the output document?
  +selective inclusion: e.g., `echo=3:5` 
```{r echo=3:5}
library("tidyverse") #1
library("here") #2
x <- c("a", "b", "c") #3
y <- c(1:3) #4
cbind(x, y) #5
rm(x); rm(y) #6
```

*`results`:
  +`hide`: hide result in the text output?
  +`asis`: 
```{r results='asis'}
cat("This is how results are written\n as is.")
```
*`warning`, `message`, `error`: show warnings and (error) messages in the output document?
*`include`: do not show in the output document (but still run the code chunk)
  +equivalent to `echo=F, results='hide', warning=F, message=F`
*`cache`: computations are saved to prevent re-running the code chunk (unless there are changes)
  +`audodep`: if a code chunk that subsequent code chunks depend on changes 

#### Options for the figures & plots  
*`fig.width` and `fig.height` define plots in inches. 
  +`fig.dim = c(6, 4)` is equivalent to  `fig.width=6, fig.height=4`

### Step 3. Code away  
#### Create a plot  
```{r fig1}
plot(cars)
```

As shown in \@ref(fig1), there is a relationship.

APA-formatted Plot  
```{r apa_graph}
ggplot(mtcars, aes(x = mpg, y = disp, colour = as.factor(mtcars$gear))) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "My Pony is Great (MPG)",
       y = "Dispicable (Disp)") +
  scale_color_discrete("Gear") +
  papaja::theme_apa(box = T) +
  theme(legend.position = c(0.8, 0.75))

ggsave("plot.png", width = 8, height = 5)
# unlink("plot.png")
```

(Optional) Import a figure
```{r}
knitr::include_graphics(here("plot.png"))
```


#### table  
Using `knitr::kable`  
```{r}
mtcars %>%
  summarise(n = n(),
            disp_mean = mean(disp, na.rm = T),
            disp_sd = sd(disp, na.rm = T)) %>%
  as.tibble() %>%
knitr::kable(booktabs = T,
             caption="Summary Table",
             digits = 2)
```

Test statistics 
```{r}
knitr::kable(coef(summary(lm(disp ~ wt*as.factor(gear),
                             data = mtcars))),
             digits = 2)
```

```{r}
knitr::kable(broom::tidy(lm(disp ~ wt*as.factor(gear),
                             data = mtcars)),
             digits = 3)
```

## Text paragraphs

### inline formatting  
[Basic formatting](https://rmarkdown.rstudio.com/authoring_basics.html)  

#### equation  
```{r}
summary(lm.fit <- lm(disp ~ as.factor(gear)*wt,
                     data = mtcars))
```
$y_{ij}$ = $\beta_0 + \beta_1 age + e$ 

...a positive slope, $\beta$ = `r round(coef(lm.fit)[4],2)`, $p$ = `r round(coef(summary(lm.fit))[4, 4],2)`

r-squared:
$R^2$

chi-square: 
$\chi^2$ 

For more LaTex [math symbols](http://web.ift.uib.no/Teori/KURS/WRK/TeX/symALL.html)

#### block quote
> ...As this pseudo-workshop dragged on, the scholars have struggled to sit through the talk. People wondered, when is this misery going to end?
>
> --- scholars

#### footnote
^[1]
^[] This is where a foot notes.


### Citing references  

1. Add the following lines in the YAML header:
---
`bibliography: reference.bib`
`csl: apa.csl`
---

2. cite away  
#### formatting   
* in-text citation
... @joel_wanting_2017 [p. 33]

* multiple citations separated by a `;`
...[see @baldwin_relational_1992; also @joel_wanting_2017]

* removing author names by putting `-`
...joel [-@joel_wanting_2017]

#### citr add-in  
```{r}
# install.packages("citr")
options(citr.use_betterbiblatex = T)
```

#### papja  
Step 1. export a bib file from your reference manager (e.g., Mendeley, Zotero)  

Step 2. `papaja::r_refs` to create a bib file   
  +.bib file will include citations for R and R packages used in the session. 
```{r}
papaja::r_refs(file = "zotero_ref.bib")
```

Step 3. `papja::cite_r` to translate them into human-readable citations  
```{r}
citations <- papaja::cite_r(file=here("workflow", "zotero_ref.bib")
                    #, pkgs = c("papaja", "here") 
                    #, withhold = F
                    #, footnote = T
                    )
```
I used `r citations` for the data analysis.


\newpage
# References
